# Dall-E Image Generator Tool
import json
from pydantic import BaseModel, Field
from openai import OpenAI


class ImagePromptSchema(BaseModel):
    """Input schema for Dall-E image generation."""
    image_description: str = Field(..., description="Description of the image to be generated by Dall-E.")
    api_key: str = Field(..., description="OpenAI API key to authenticate the request.")


def main(image_description: str, api_key: str) -> str:
    """
    Generate an image using OpenAI Dall-E.

    Args:
        image_description (str): The prompt describing the image.
        api_key (str): OpenAI API key for authentication.

    Returns:
        str: JSON string containing image URL and prompt.
    """
    if not image_description:
        return json.dumps({"error": "Image description is required."})

    client = OpenAI(api_key=api_key)

    response = client.images.generate(
        model="dall-e-3",
        prompt=image_description,
        size="1024x1024",
        quality="standard",
        n=1,
    )

    image_data = {
        "image_url": response.data[0].url,
        "image_description": getattr(response.data[0], "revised_prompt", image_description)
    }

    return json.dumps(image_data)
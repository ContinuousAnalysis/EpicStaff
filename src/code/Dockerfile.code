FROM python:3.12.10

WORKDIR /home/user/root/app

RUN apt-get update && \
    apt-get install -y git curl && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# Install opencode CLI
RUN curl -fsSL https://opencode.ai/install | bash
ENV PATH="/root/.opencode/bin:${PATH}"

# Bake skill files into image
COPY ./code/opencode/skills opencode/skills

# Copy instance manager
COPY ./code/instance_manager.py .
COPY ./code/start.sh .

RUN chmod +x start.sh

CMD ["./start.sh"]

<div class="main-container">
  <!-- Header with title and close button -->
  <app-form-header
    [title]="agentForm.value.role || 'Create New Agent'"
    (cancel)="onCancelForm()"
  >
  </app-form-header>

  <div class="content">
    <form [formGroup]="agentForm" (ngSubmit)="onSubmitForm()">
      <!-- Basic Field: name with icon selector -->
      <div class="custom-field name-with-icon">
        <label for="role">Agent Role <span class="required">*</span></label>
        <div class="input-with-icon">
          <!-- Icon Picker Component -->
          <app-icon-picker
            [selectedIcon]="selectedIcon"
            (iconSelected)="onIconSelected($event)"
          ></app-icon-picker>
          <input
            id="role"
            type="text"
            formControlName="role"
            placeholder="Enter agent role..."
            autocomplete="off"
          />
        </div>
        <div
          class="error-message"
          *ngIf="
            agentForm.get('role')?.touched &&
            agentForm.get('role')?.dirty &&
            agentForm.get('role')?.hasError('required')
          "
        >
          Agent role is required
        </div>
      </div>

      <!-- Basic Field: Goal -->
      <div class="custom-field">
        <label for="goal">Goal <span class="required">*</span></label>
        <textarea
          id="goal"
          formControlName="goal"
          placeholder="Enter agent goal"
          rows="3"
          autocomplete="off"
        ></textarea>
        <div
          class="error-message"
          *ngIf="
            agentForm.get('goal')?.touched &&
            agentForm.get('goal')?.dirty &&
            agentForm.get('goal')?.hasError('required')
          "
        >
          Agent goal is required
        </div>
      </div>

      <!-- Basic Field: Backstory -->
      <div class="custom-field">
        <label for="backstory">Backstory <span class="required">*</span></label>
        <textarea
          id="backstory"
          formControlName="backstory"
          placeholder="Enter agent backstory"
          rows="3"
          autocomplete="off"
        ></textarea>
        <div
          class="error-message"
          *ngIf="
            agentForm.get('backstory')?.touched &&
            agentForm.get('backstory')?.dirty &&
            agentForm.get('backstory')?.hasError('required')
          "
        >
          Agent backstory is required
        </div>
      </div>

      <!-- LLM Configurations - Only Agent LLM in main settings -->
      <div class="custom-field">
        <label>Agent LLM</label>
        <app-llm-selector
          label="Agent LLM Config"
          placeholder="Select an agent LLM configuration"
          [required]="false"
          [selectedValue]="agentForm.get('llm_config')?.value"
        ></app-llm-selector>
      </div>

      <!-- Creativity Level Slider -->
      <app-form-slider
        [value]="temperatureValue"
        label="Agent Creativity Level:"
        (valueChange)="onSliderInput($event)"
      ></app-form-slider>

      <!-- Advanced Settings Toggle Button -->
      <button
        type="button"
        class="toggle-settings"
        (click)="toggleAdvancedSettings()"
      >
        {{
          advancedSettingsVisible
            ? "Hide Advanced Settings"
            : "Show Advanced Settings"
        }}
      </button>

      <!-- Advanced Settings Section -->
      <div *ngIf="advancedSettingsVisible" @smoothExpand>
        <!-- Function LLM moved to advanced settings -->
        <div class="custom-field">
          <label>Function LLM</label>
          <app-llm-selector
            label="Function LLM Config"
            placeholder="Select a function LLM configuration"
            [required]="false"
            [selectedValue]="agentForm.get('fcm_llm_config')?.value"
          ></app-llm-selector>
        </div>

        <!-- Allow Delegation Toggle -->
        <div class="toggle-field">
          <div class="toggle-label">Allow Delegation</div>
          <app-toggle-switch
            formControlName="allow_delegation"
          ></app-toggle-switch>
        </div>

        <!-- Memory Toggle -->
        <div class="toggle-field">
          <div class="toggle-label">Memory</div>
          <app-toggle-switch formControlName="memory"></app-toggle-switch>
        </div>

        <!-- Cache Toggle -->
        <div class="toggle-field">
          <div class="toggle-label">Cache</div>
          <app-toggle-switch formControlName="cache"></app-toggle-switch>
        </div>

        <!-- Allow Code Execution Toggle -->
        <div class="toggle-field">
          <div class="toggle-label">Allow Code Execution</div>
          <app-toggle-switch
            formControlName="allow_code_execution"
          ></app-toggle-switch>
        </div>

        <!-- Respect Context Window Toggle -->
        <div class="toggle-field">
          <div class="toggle-label">Respect Context Window</div>
          <app-toggle-switch
            formControlName="respect_context_window"
          ></app-toggle-switch>
        </div>

        <!-- Max Iterations Input -->
        <div class="custom-field">
          <label for="max_iter">Max Iterations</label>
          <input
            id="max_iter"
            type="number"
            formControlName="max_iter"
            placeholder="Enter max iterations"
            min="1"
          />
        </div>

        <!-- Max RPM Slider -->
        <app-form-slider
          [value]="maxRpmSliderValue"
          [max]="200"
          label="Max Requests Per Minute (0-50):"
          (valueChange)="onMaxRpmSliderInput($event)"
        ></app-form-slider>

        <!-- Max Execution Time Input -->
        <div class="custom-field">
          <label for="max_execution_time">Max Execution Time (seconds)</label>
          <input
            id="max_execution_time"
            type="number"
            formControlName="max_execution_time"
            placeholder="Enter execution time"
          />
        </div>

        <!-- Max Retry Limit Input -->
        <div class="custom-field">
          <label for="max_retry_limit">Max Retry Limit</label>
          <input
            id="max_retry_limit"
            type="number"
            formControlName="max_retry_limit"
            placeholder="Enter max retry limit"
          />
        </div>
      </div>
    </form>
  </div>

  <!-- Footer with action buttons -->
  <app-form-footer
    [isSubmitDisabled]="agentForm.invalid"
    [isSubmitting]="isSubmitting"
    (cancel)="onCancelForm()"
    (submit)="onSubmitForm()"
  ></app-form-footer>
</div>

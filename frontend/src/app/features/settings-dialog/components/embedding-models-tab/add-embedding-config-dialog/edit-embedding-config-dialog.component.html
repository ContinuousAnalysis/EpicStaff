<div class="dialog-container">
  <div class="dialog-header">
    <h2>Edit Embedding Configuration</h2>
  </div>
  <div class="dialog-content">
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      @if (errorMessage()) {
        <div class="error-message">
          <p>{{ errorMessage() }}</p>
        </div>
      }
      <div class="form-field">
        <label class="form-field__label">
          Provider & Model <span class="required">*</span>
        </label>
        <button type="button" class="model-selector" (click)="openModelSelector()">
          @if (selectedProvider()) {
            <app-icon [icon]="getProviderIcon(selectedProvider()!.name)" size="1.25rem" />
          }
          @if (selectedModel() && selectedProvider()) {
            <span class="model-selector__text">
              <span class="model-selector__provider">{{ selectedProvider()!.name }}</span>
              <span class="model-selector__separator"> / </span>
              <span class="model-selector__model">{{ selectedModel()!.name }}</span>
            </span>
          } @else {
            <span class="model-selector__text model-selector__text--placeholder">
              Select a model...
            </span>
          }
          <app-icon icon="ui/chevron-down" size="1rem" />
        </button>
        @if (form.get('modelId')?.invalid && !selectedModelId()) {
          <div class="error-hint">
            Please select provider and model
          </div>
        }
      </div>
      <div class="form-field">
        <label for="customName"
          >Configuration Name <span class="required">*</span></label
        >
        <input
          id="customName"
          type="text"
          class="form-input"
          placeholder="Enter a custom name"
          formControlName="customName"
        />
        @if (form.get('customName')?.invalid && form.get('customName')?.touched) {
          <div class="error-hint">
            Configuration name is required
          </div>
        }
      </div>
      <div class="form-field">
        <label for="apiKey">API Key <span class="required">*</span></label>
        <div class="form-input-wrapper">
          <input
            id="apiKey"
            [type]="showApiKey() ? 'text' : 'password'"
            class="form-input form-input--with-action"
            placeholder="Enter provider's API key"
            formControlName="apiKey"
          />
          <button
            type="button"
            class="form-input-action"
            (click)="toggleApiKeyVisibility()"
            [attr.aria-label]="showApiKey() ? 'Hide API key' : 'Show API key'"
          >
            <app-icon [icon]="showApiKey() ? 'ui/eye-off' : 'ui/eye'" size="1.25rem" />
          </button>
        </div>
        @if (form.get('apiKey')?.invalid && form.get('apiKey')?.touched) {
          <div class="error-hint">
            API key is required
          </div>
        }
      </div>
      <div class="dialog-actions">
        <app-button type="ghost" (click)="onCancel()">Cancel</app-button>
        <app-button
          type="primary"
          (click)="onSubmit()"
          [disabled]="!isFormValid() || isSubmitting()"
        >
          {{ isSubmitting() ? "Updating..." : "Update" }}
        </app-button>
      </div>
    </form>
  </div>
</div>

<div class="tags-filter-container">
    <p-button
        #btn
        [label]="buttonText()"
        icon="pi pi-tag"
        iconPos="left"
        severity="secondary"
        [outlined]="true"
        (onClick)="toggleOverlay($event)"
        [badge]="selectedTagsCount() > 0 ? selectedTagsCount().toString() : ''"
        badgeClass="p-badge-info"
    ></p-button>

    <p-popover #op [dismissable]="true" (onShow)="initTempSelection()">
        <div class="dropdown-content">
            <div class="dropdown-header">
                <h3>Filter by Tags</h3>
                <p-button
                    label="Clear All"
                    severity="secondary"
                    [text]="true"
                    (onClick)="onClearAll()"
                    *ngIf="tempSelectedTagIds().length > 0"
                ></p-button>
            </div>

            <div class="tags-list" *ngIf="isTagsLoaded(); else loadingTags">
                <p-button
                    *ngFor="let tag of allTags(); trackBy: trackByTagId"
                    [label]="tag.name"
                    [severity]="isTagSelected(tag.id) ? 'primary' : 'secondary'"
                    [outlined]="!isTagSelected(tag.id)"
                    [icon]="
                        isTagSelected(tag.id) ? 'pi pi-check' : 'pi pi-plus'
                    "
                    iconPos="right"
                    class="tag-btn"
                    (onClick)="toggleTag(tag.id)"
                ></p-button>
            </div>

            <ng-template #loadingTags>
                <div class="loading-message">Loading tags...</div>
            </ng-template>

            <div class="dropdown-actions">
                <p-button
                    label="Cancel"
                    severity="secondary"
                    [outlined]="true"
                    (onClick)="onCancel()"
                ></p-button>
                <p-button
                    label="Apply"
                    severity="primary"
                    (onClick)="onApply()"
                ></p-button>
            </div>
        </div>
    </p-popover>
</div>

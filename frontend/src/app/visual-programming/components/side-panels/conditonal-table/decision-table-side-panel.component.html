<div class="wrapper">
  <!-- Header: Icon + Table Name + Close Button -->
  <div class="dialog-header">
    <div class="icon-and-title">
      <i class="ti ti-table"></i>
      <span class="title">{{
        decisionTableForm.value.name || "New Decision Table"
      }}</span>
    </div>
    <i class="ti ti-x close-icon" (click)="close()"></i>
  </div>

  <!-- Scrollable Form Content -->
  <div class="dialog-content">
    <form [formGroup]="decisionTableForm">
      <!-- Table Name Field -->
      <div class="form-group">
        <label for="name">Table Name</label>
        <input
          id="name"
          type="text"
          formControlName="name"
          placeholder="Enter table name"
        />
      </div>

      <!-- Order Type Field: display only if more than one condition -->
      <div class="form-group" *ngIf="conditions.length > 1">
        <label for="orderType">Order Type</label>
        <select id="orderType" formControlName="orderType">
          <option value="and">AND</option>
          <option value="or">OR</option>
        </select>
      </div>

      <!-- Conditions List with Drag & Drop -->
      <div class="form-group conditions">
        <label>
          Conditions
          <i class="ti ti-plus" (click)="addCondition()"></i>
        </label>
        <!-- Wrap the condition list in a cdkDropList -->
        <div
          class="condition-list"
          formArrayName="conditions"
          cdkDropList
          (cdkDropListDropped)="drop($event)"
        >
          <div
            class="condition-item"
            *ngFor="let condCtrl of conditions.controls; let i = index"
            [formGroupName]="i"
            cdkDrag
          >
            <!-- Drag handle: Only this area initiates dragging -->
            <div class="drag-handle" cdkDragHandle>
              <i class="ti ti-grip-vertical"></i>
            </div>

            <div class="condition-header">
              <span class="condition-label">{{ getConditionLabel(i) }}</span>
              <i
                class="ti ti-trash delete-icon"
                (click)="removeCondition(i)"
              ></i>
            </div>
            <!-- Field labels row -->
            <div class="condition-field-labels">
              <span class="field-label">Name</span>
              <span class="field-label">Value</span>
            </div>
            <div class="condition-fields">
              <input
                type="text"
                formControlName="name"
                placeholder="Condition Name"
              />
              <input
                type="text"
                formControlName="value"
                placeholder="Condition Value"
              />
            </div>
          </div>
        </div>
        <button
          type="button"
          class="add-condition-btn"
          (click)="addCondition()"
        >
          <i class="ti ti-plus"></i>
          Add Condition
        </button>
      </div>
    </form>
  </div>

  <!-- Fixed Action Buttons -->
  <div class="actions">
    <button type="button" (click)="close()">Cancel</button>
    <button
      type="button"
      [disabled]="decisionTableForm.invalid"
      (click)="onSave()"
    >
      Save
    </button>
  </div>
</div>

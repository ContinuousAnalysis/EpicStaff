<!-- Node Details: Shown when the parent has toggled expand -->
<div class="node-details" *ngIf="parentExpanded()" @expandCollapse>
  <!-- Goal Section -->
  <div class="detail-block">
    <div class="detail-header">
      <span class="detail-label">GOAL</span>
    </div>
    <div class="detail-content">
      <p class="detail-text">
        {{
          isGoalExpanded() ? node.data.goal : (node.data.goal | slice : 0 : 120)
        }}
        <span *ngIf="!isGoalExpanded() && node.data.goal.length > 120"
          >...</span
        >
      </p>
    </div>
    <div
      class="toggle-link"
      *ngIf="node.data.goal.length > 120"
      (click)="toggleGoal($event)"
    >
      <span
        *ngIf="!isGoalExpanded()"
        (mousedown)="$event.stopPropagation()"
        (mouseup)="$event.stopPropagation()"
        >Show More</span
      >
      <span
        *ngIf="isGoalExpanded()"
        (mousedown)="$event.stopPropagation()"
        (mouseup)="$event.stopPropagation()"
        >Show Less</span
      >
    </div>
  </div>

  <!-- Backstory Section -->
  <div class="detail-block">
    <div class="detail-header">
      <span class="detail-label">BACKSTORY</span>
    </div>
    <div class="detail-content">
      <p class="detail-text">
        {{
          isBackstoryExpanded()
            ? node.data.backstory
            : (node.data.backstory | slice : 0 : 120)
        }}
        <span *ngIf="!isBackstoryExpanded() && node.data.backstory.length > 120"
          >...</span
        >
      </p>
    </div>
    <div
      class="toggle-link"
      *ngIf="node.data.backstory.length > 120"
      (click)="toggleBackstory($event)"
    >
      <span
        *ngIf="!isBackstoryExpanded()"
        (mousedown)="$event.stopPropagation()"
        (mouseup)="$event.stopPropagation()"
        >Show More</span
      >
      <span
        *ngIf="isBackstoryExpanded()"
        (mousedown)="$event.stopPropagation()"
        (mouseup)="$event.stopPropagation()"
        >Show Less</span
      >
    </div>
  </div>
</div>

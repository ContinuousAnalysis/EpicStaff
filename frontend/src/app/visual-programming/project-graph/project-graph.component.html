@if (isLoaded) {

<f-flow
  appMouseTracker
  (mousePosition)="updateMouseTrackerPosition($event)"
  (contextmenu)="onContextMenu($event)"
  fDraggable
  class="visual-programming-flow"
  appShortcutListener
  (delete)="onDelete()"
  (undo)="onUndo()"
  (redo)="onRedo()"
  (copy)="onCopy()"
  (paste)="onPaste()"
  (fReassignConnection)="onReassignConnection($event)"
  (fCreateConnection)="onConnectionAdded($event)"
  (fCreateNode)="onNodeAdded($event)"
>
  <f-background>
    <f-circle-pattern></f-circle-pattern>
  </f-background>
  <f-line-alignment></f-line-alignment>
  <f-canvas fZoom>
    <f-snap-connection
      fBehavior="fixed"
      fType="segment"
      [fRadius]="50"
      [fOffset]="30"
      [fSnapThreshold]="35"
    >
      <!-- <svg
        viewBox="0 0 10 10"
        fMarker
        [type]="eMarkerType.START"
        [height]="10"
        [width]="10"
        [refX]="5"
        [refY]="5"
      >
        <circle cx="5" cy="5" r="2" stroke="none"></circle>
      </svg> -->
      <svg
        viewBox="0 0 6 6"
        fMarker
        [type]="eMarkerType.END"
        [height]="6"
        [width]="6"
        [refX]="5"
        [refY]="3"
      >
        <path d="M0,0 L6,3 0,6Z" stroke="none" fill="#3f3f3f"></path>
      </svg>
    </f-snap-connection>
    <f-connection-for-create fBehavior="floating" fType="straight">
      <svg
        viewBox="0 0 10 10"
        fMarker
        [type]="eMarkerType.START"
        [height]="10"
        [width]="10"
        [refX]="5"
        [refY]="5"
      >
        <circle
          cx="5"
          cy="5"
          r="2"
          stroke="none"
          fill="var(--primary-3)"
        ></circle>
      </svg>
      <svg
        viewBox="0 0 6 6"
        fMarker
        [type]="eMarkerType.END"
        [height]="6"
        [width]="6"
        [refX]="6"
        [refY]="3"
      >
        <path d="M0,0 L6,3 0,6Z" stroke="none" fill="var(--primary-3)"></path>
      </svg>
    </f-connection-for-create>
    @for (connection of flowService.connections(); track connection.id) {
    <f-connection
      fBehavior="fixed"
      fType="segment"
      [fOffset]="30"
      fStartColor="#2c2c2c"
      fEndColor="#2c2c2c"
      [fOutputId]="connection.sourcePortId"
      [fInputId]="connection.targetPortId"
      [fConnectionId]="connection.id"
    >
      <svg
        viewBox="0 0 10 10"
        fMarker
        [type]="eMarkerType.START"
        [height]="10"
        [width]="10"
        [refX]="5"
        [refY]="5"
        fill="#2c2c2c"
      >
        <circle cx="5" cy="5" r="2" stroke="none" fill="#2c2c2c"></circle>
      </svg>
      <svg
        viewBox="0 0 6 6"
        fMarker
        [type]="eMarkerType.END"
        [height]="6"
        [width]="6"
        [refX]="6"
        [refY]="3"
        fill="#2c2c2c"
      >
        <path d="M0,0 L6,3 0,6Z" stroke="none" fill="#2c2c2c"></path>
      </svg>
      <svg
        viewBox="0 0 10 10"
        fMarker
        [type]="eMarkerType.SELECTED_START"
        [height]="10"
        [width]="10"
        [refX]="5"
        [refY]="5"
        fill="#fdfdfd"
      >
        <circle cx="5" cy="5" r="2" stroke="none" fill="#2c2c2c"></circle>
      </svg>
      <svg
        viewBox="0 0 6 6"
        fMarker
        [type]="eMarkerType.SELECTED_END"
        [height]="6"
        [width]="6"
        [refX]="6"
        [refY]="3"
        fill="#fdfdfd"
      >
        <path d="M0,0 L6,3 0,6Z" stroke="none" fill="#2c2c2c"></path>
      </svg>
    </f-connection>
    } @for (node of flowService.nodes(); track node.id) {
    <app-flow-base-node
      [node]="node"
      fNode
      fDragHandle
      [fNodeId]="node.id"
      [fNodeParentId]="node.parentId"
      [fNodePosition]="node.position"
      (fNodePositionChange)="onNodePositionChanged($event, node)"
    >
    </app-flow-base-node>
    }
  </f-canvas>
  <f-selection-area></f-selection-area>
  <f-minimap [fMinSize]="1000"></f-minimap>
</f-flow>

}
